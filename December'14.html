<!DOCTYPE html>
<meta charset="utf-8">

<style>
</style>

<body>
<script src="//d3js.org/d3.v3.min.js"></script>
<script src="//d3js.org/topojson.v1.min.js"></script>
<script>
var w = 1400;
var h = 800;

var svg = d3.select("body")
            .append("svg")
            .attr("width", w)
            .attr("height", h);


var projection = d3.geo.mercator()
                    .scale(w/7)
                    .translate([w/2, h/2]);

var path = d3.geo.path()
                  .projection(projection);


d3.json("world.json", function(json) {
  svg.selectAll("path")
      .data(json.features)
      .enter()
      .append("path")
      .attr("d", path); 

  d3.csv("dec14.csv", function(data) {

    svg.selectAll("circle")
      .data(data)
      .enter()
      .append("circle")
      .attr("cx", function(d) {
          return projection([d.longitude, d.latitude])[0];
          })
      .attr("cy", function(d) {
          return projection([d.longitude, d.latitude])[1];
          })
      .attr("r", function(d) {
          return Math.sqrt(parseInt(d.count)+1)*2
          })
      .style("fill", "blueviolet")
      .style("opacity", 0.75)
      .append("svg:title")
      .text(function(d) {
          return d.name;
          })
      .attr("x", function(d) {
          return projection([d.longitude -(-1.5), d.latitude])[0];
          })
      .attr("y", function(d) {
          return projection([d.longitude, d.latitude])[1]; 
          })
      .style("fill", "purple")
      .style("font-size", 12);

  });

})

</script>
